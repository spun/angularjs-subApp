angular.module("subApp",["subApp.filters","subApp.services","subApp.directives.uploads","subApp.directives","subApp.controllers","ngAnimate","toast"]);var myControllers=angular.module("subApp.controllers",[]);myControllers.controller("MainCtrl",["$scope","FileCenter","toastService",function(a,b,c){"use strict";a.file=b,a.showLineList=!1,a.showSyncOptions=!1,a.selectedLinesArray=[],a.resyncTime={hours:0,minutes:0,seconds:0,miliseconds:0},a.toggleLineList=function(){a.showLineList=!a.showLineList,a.showLineList===!0?a.showLineList===!0&&(a.showSyncOptions=!a.showLineList):a.deselectAll()},a.toggleSyncOptions=function(){a.showSyncOptions=!a.showSyncOptions,a.showLineList===!0&&a.showLineList===!0&&(a.showLineList=!a.showSyncOptions)},a.selectLine=function(b,c){b.selected===!0?a.deselectAll():(a.deselectAll(),b.selected=!0,a.selectedLinesArray.push(b),c.stopPropagation(),c.preventDefault())},a.deselectAll=function(){for(;a.selectedLinesArray.length>0;)a.selectedLinesArray.pop().selected=!1},a.sync=function(d){d===!0?(b.addTime(a.resyncTime),c.pop("Time added")):d===!1&&(b.removeTime(a.resyncTime),c.pop("Time removed")),a.showSyncOptions=!1,a.resyncTime={hours:0,minutes:0,seconds:0,miliseconds:0}},a.closeFile=function(){a.deselectAll(),a.showLineList=!1,a.showSyncOptions=!1,a.file.reset()},a.download=function(){var c=b.exportSubRip(),d=document.createElement("a");d.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(c)),d.setAttribute("download",a.file.name),document.body.appendChild(d),d.click(),document.body.removeChild(d)}}]);var myDirectives=angular.module("subApp.directives",[]);myDirectives.directive("wKeydown",function(){"use strict";return function(a,b,c){b.bind("keydown",function(b){switch(b.keyCode){case 27:return a.$apply(c.wEsc)}})}}),myDirectives.directive("timeStampEditor",function(){"use strict";return{restrict:"E",scope:{description:"@",time:"="},template:'<p>    Minutes:    </br><input type="range" min="0" max="59" ng-model="time.minutes"/></p><p>    Seconds:    </br><input type="range" min="0" max="59" ng-model="time.seconds"/></p><p>    Miliseconds:    </br><input type="range" min="0" max="999" ng-model="time.miliseconds"/></p><p>    {{description}}:        <input type="text" min="0" max="99" size="2" ng-model="time.hours"/> :    <input type="text" min="0" max="59" size="2" ng-model="time.minutes"/> :    <input type="text" min="0" max="59" size="2" ng-model="time.seconds"/> ,    <input type="text" min="0" max="999" size="3" ng-model="time.miliseconds"/></p>'}});var myServices=angular.module("subApp.services",[]);myServices.value("version","0.1"),myServices.factory("FileCenter",["subtitleTimeFilter",function(a){"use strict";return{fileLoaded:!1,name:"",type:"",lastModifiedDate:"",size:0,lines:[],setSize:function(a){this.size=a},addLine:function(a,b,c,d){var e={lineNumber:a,startTime:b,endTime:c,lineContent:d};this.lines.push(e)},timeToMiliseconds:function(a){var b=0;return b+=36e5*parseInt(a.hours,10),b+=6e4*parseInt(a.minutes,10),b+=1e3*parseInt(a.seconds,10),b+=parseInt(a.miliseconds,10)},milisecondsToTime:function(a){var b,c={};return c.miliseconds=a%1e3,b=Math.floor(a/1e3),c.seconds=b%60,b=Math.floor(b/60),c.minutes=b%60,b=Math.floor(b/60),c.hours=b,c},addTime:function(a){var b,c,d,e,f,g,h=0,i=this.lines.length,j=this.timeToMiliseconds(a);for(h=0;i>h;h+=1)b=this.lines[h].startTime,c=this.timeToMiliseconds(b),d=c+j,this.lines[h].startTime=this.milisecondsToTime(d),e=this.lines[h].endTime,f=this.timeToMiliseconds(e),g=f+j,this.lines[h].endTime=this.milisecondsToTime(g)},removeTime:function(a){var b,c,d,e,f,g,h=0,i=this.lines.length,j=this.timeToMiliseconds(a);for(h=0;i>h;h+=1)b=this.lines[h].startTime,c=this.timeToMiliseconds(b),d=c-j,this.lines[h].startTime=d>0?this.milisecondsToTime(d):{hours:0,minutes:0,seconds:0,miliseconds:0},e=this.lines[h].endTime,f=this.timeToMiliseconds(e),g=f-j,this.lines[h].endTime=g>0?this.milisecondsToTime(g):{hours:0,minutes:0,seconds:0,miliseconds:0}},importFile:function(a,b,c,d,e,f){switch(this.reset(),this.name=a,this.size=c,this.type=d,this.lastModifiedDate=e,b){case"srt":this.importSubRip(f);break;case"xml":}},importSubRip:function(a){for(var b,c,d,e,f,g,h=/(\d+)\r\n([\d+:,]+) --> ([\d+:,]+)\r\n(.*\r\n.*)/g,i=h.exec(a);null!==i;)i.index===h.lastIndex&&(h.lastIndex+=1),b=i[2].split(":"),c=b[2].split(","),d={hours:parseInt(b[0],10),minutes:parseInt(b[1],10),seconds:parseInt(c[0],10),miliseconds:parseInt(c[1],10)},e=i[3].split(":"),f=e[2].split(","),g={hours:parseInt(e[0],10),minutes:parseInt(e[1],10),seconds:parseInt(f[0],10),miliseconds:parseInt(f[1],10)},this.addLine(i[1],d,g,i[4]),i=h.exec(a);this.fileLoaded=!0},exportSubRip:function(){var b="",c=this.lines.length,d=0;for(d=0;c>d;d+=1)b+=this.lines[d].lineNumber+"\r\n",b+=a(this.lines[d].startTime)+" --> "+a(this.lines[d].endTime)+"\r\n",b+=this.lines[d].lineContent+"\r\n\r\n";return b},reset:function(){for(this.fileLoaded=!1,this.name="",this.type="",this.lastModifiedDate="",this.size=0;this.lines.length>0;)this.lines.pop()}}}]);var myFilters=angular.module("subApp.filters",[]);myFilters.filter("subtitleTime",function(){"use strict";function a(a,b){for(var c=String(a);c.length<b;)c="0"+c;return c}return function(b){var c=a(b.hours,2)+":";return c+=a(b.minutes,2)+":",c+=a(b.seconds,2)+",",c+=a(b.miliseconds,3)}});var uploadsDirectives=angular.module("subApp.directives.uploads",[]);uploadsDirectives.directive("upload",["FileCenter","toastService",function(a,b){"use strict";return{restrict:"A",controller:["$scope",function(c){this.processFiles=function(d){var e,f,g,h=d.length,i=/^[\u0000-\uFFF0]*$/,j=/^.+\.(srt|xml)$/i,k=["UTF-8","ASCII"],l=0;1===h&&(e=d[0],l=0,g=j.exec(e.name),null===g?(b.pop("Only SubRip files (srt) are supported right now"),c.$apply()):(f=new FileReader,f.onload=function(b,d){return function(){var f=this.result;i.test(f)?(a.importFile(e.name,g[1],e.size,e.type,e.lastModifiedDate,f),c.$apply()):(d+=1,k[d]&&this.readAsText(b,k[d]))}}(e,l),f.readAsText(e,k[l])))}}]}}]),uploadsDirectives.directive("dndUpload",function(){"use strict";return{restrict:"A",require:"upload",link:function(a,b,c,d){b.bind("dragover",function(a){b.addClass("fileover"),a.stopPropagation(),a.preventDefault(),a.dataTransfer.dropEffect="copy"}),b.bind("dragleave",function(a){b.removeClass("fileover"),a.stopPropagation(),a.preventDefault(),a.dataTransfer.dropEffect="copy"}),b.bind("drop",function(a){b.removeClass("fileover");var c=a.dataTransfer.files;d.processFiles(c),a.stopPropagation(),a.preventDefault()})}}}),uploadsDirectives.directive("manualUpload",function(){"use strict";return{restrict:"A",require:"upload",link:function(a,b,c,d){b.bind("change",function(a){var b=a.target.files;d.processFiles(b)})}}});var toastDirective=angular.module("toast",["ngAnimate"]);toastDirective.service("toastService",["$rootScope",function(a){"use strict";this.pop=function(b){this.toast={message:b},a.$broadcast("toast-newToast")}}]),toastDirective.directive("toastContainer",["$timeout","toastService",function(a,b){"use strict";return{scope:!0,link:function(c){function d(a){var b=c.toastList.indexOf(a);b>-1&&c.toastList.splice(b,1)}function e(b,c){b.timeout=a(function(){d(b)},c)}function f(a){c.toastList.unshift(a),e(a,3e3)}c.toastList=[],c.$on("toast-newToast",function(){f(b.toast)})},template:'<div class="toast-container"><div ng-repeat="toast in toastList" class="toast">    {{toast.message}}</div></div>'}}]);